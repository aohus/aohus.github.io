---
layout: post
title: "[Network] 라우터/L3 스위치 : 3계층 장비"
subtitle:
categories: Network
tags: ["IT 엔지니어를 위한 네트워크 입문"]
---

# Chapter5: 라우터/L3 스위치 : 3계층 장비  
라우터는 3계층에서 동작하는 여러 네트워크 장비의 대표격으로 그 이름처럼 경로를 지정해주는 장비입니다. 라우터에 들어오는 패킷의 목적지 IP 주소를 확인하고 자신이 가진 경로(route)를 이용하여 패킷을 최적의 경로로 포워딩 합니다.   
  
라우터는 원격지 네트워크와 연결할 때 필수 네트워크 장비이며 네트워크를 구성하는 핵심 장비입니다.   
  
## 5.1 라우터의 동작 방식과 역할  
- 경로 지정 :  
	- 다양한 경로 정보 수집하여 최적의 경로를 라우팅 테이블에 저장  
	- 패킷이 라우터로 들어오면 도착지 ip 주소와 라우팅 테이블을 비교해 최선의 경로로 패킷을 보냄  
- 브로드캐스트 컨트롤 :  
	- **패킷의 목적지 주소가 라우팅 테이블에 없으면 패킷을 버림**(스위치는 플로팅)  
- 프로토콜 변환 :  
	- 패킷 포워딩 과정에서 기존 2계층 헤더 정보를 제거한 후 새로운 2계층 헤더를 만들어냄  
  
### 5.1.1 경로지정  
- IP 주소는 네트워크 주소 & 호스트 주소 -> 로컬 네트워크와 원격지 네트워크를 구분할 수 있고 네트워크 주소를 기반으로 경로를 찾아감  
  
라우터는 경로를 지정해 피킷을 포워딩하는 역할을 두 가지로 구분해 수행  
1) 경로 정보를 얻는 역할  
2) 얻은 경로 정보를 확인하고 패킷을 포워딩하는 역할  
  
경로 정보를 얻는 방법  
1) IP 주소를 입력하면서 자연스럽게 인접 네트워크 정보를 얻음  
2) 관리자가 직접 경로 정보를 입력  
3) 라우터끼리 서로 경로 정보를 자동으로 교환  
  
### 5.1.2 브로드캐스트 컨트롤  
- 스위치는 패킷의 도착지 주소를 모르면 플러딩해서 패킷을 모든 포트에 전송(LAN 어딘가에 도착지 있을 것이라고 가정) -> LAN은 생각보다 크기 작아서 네트워크에 큰 무리를 주지 않음   
- 라우터는 분명한 도착지 정보가 있을 때만 통신을 허락  
  
### 5.1.3 프로토콜 변환  
현대 네트워크는 이더넷으로 수렴되므로 서로다른 프로토콜로 구성된 네트워크를 연결하는 역할이 많이 줄었지만, 과거에는 LAN에서 사용하는 프로토콜과 WAN에서 사용하는 프로토콜이 전혀 다른 완전히 구분된 공간이었음.   
-> LAN 기술이 WAN기술로 변환되어야만 원격지 네트워크와의 통신이 가능했고 라우터가 그 역할을 함  
  
라우터에 패킷이 들어오면 2계층까지의 헤더 정보를 벗겨내고 3계층 주소를 확인 한 후 2계층 헤더 정보를 새로 만들어 외부로 내보냄  
- LAN L2 헤더 : 이더넷 헤더(이더 헤더)  
- WAN L2 헤더 : PPP 헤더  
  
  
## 5.2 경로 지정 - 라우팅/스위칭  
라우터가 패킷을 처리할 때  
- 경로 정보를 얻어 경로 정보를 정리  
- 정리된 경로 정보를 기반으로 패킷을 포워딩  
  
라우터는 자신이 알고 있는 주소가 아닌 목적지를 가진 패킷이 들어오면 버리므로, 패킷이 들어오기 전에 경로 정보를 충분히 수집하고 있어야합니다. 하지만 복잡한 네트워크 정보로 원하는 목적지 정보와 수집한 (다양한) 경로가 정확히 일치하지 않는 경우가 더 많습니다.   
-> **라우터는 서브넷 단위로 라우팅 정보를 습득하고 라우팅 정보를 최적화하기 위해 서머리 작업을 통해 여러 개의 서브넷 정보를 뭉쳐 전달합니다.** 그래서 라우터에 들어온 패킷의 목적지 주소와 라우터가 갖고 있는 테이블 정보가 정확히 일치하지 않더라도 목적지에 가장 근접한 정보를 찾아 패킷을 포워딩해야합니다.   
  
### 5.2.1 라우팅 동작과 라우팅 테이블  
- 홉바이홉 - 현대 인터넷에서는 단말부터 목적지까지의 경로를 모두 책임지는 것이 아니라 인접한 라우터까지만 경로를 지정하면 인접라우터에서 최적의 경로를 다시 파악한 후 라우터로 패킷을 포워딩함. 넥스트 홉은 다음과 같은 방법으로 지정  
	- 다음 라우터의 IP를 지정(일반적)  
	- 라우터의 나가는 인터페이스를 지정(특수)  
	- 라우터의 나가는 인터페이스와 다음 라우터의 IP를 동시에 지정  
  
- 라우팅 테이블에 저장하는 데이터  
	- 목적지 주소  
	- 넥스트 홉 IP 주소, 나가는 로컬 인터페이스  
  
- 3계층 TTL  
	- 3계층 IP 헤더에는 TTL: Time To Live 라는 필드가 있다. 이동할 수 있는 최대 홉수를 나타내며 최대 홉수를 넘어가면 사라진다.   
  
### 5.2.2 라우팅(라우터가 경로 정보를 얻는 방법)  
- 다이렉트 커넥티드 : IP 주소를 입력하면서 자연스럽게 인접 네트워크 정보를 얻음  
- 스태틱 라우팅 : 관리자가 직접 경로 정보를 입력  
- 다이나믹 라우팅 : 라우터끼리 서로 경로 정보를 자동으로 교환  
  
### 5.2.3 스위칭(라우터가 경로를 지정하는 방법)  
스위칭 : 패킷이 들어와 라우팅 테이블을 참조하고 최적의 경로를 찾아 라우터 외부로 포워딩하는 작업  
- longest prefix match : 갖고 있는 경로 정보 중 가장 가까운 경로를 선택(exact match 아닐 때) -> 리소스 많이 소모  
- 한 번 스위칭 작업을 수행한 정보는 캐시에 저장하고 이후 패킷은 라우팅 테이블보다 **캐시를 먼저 확인**  
  
### 5.2.4 라우팅 스위칭 우선순위  
좋은 경로 정보의 우선순위는 경로 정보를 받은 방법과 거리를 기준으로 정한다.   
1) 내가 갖고 있는 네트워크(다이렉트 커넥티드)  
2) 내가 경로를 직접 지정한 네트워크(스태틱 라우팅)  
3) 경로를 전달 받은 네트워크(다이나믹 라우팅)  
이런 우선순위를 AD(Administrative Distance 관리거리)라고 부르고, 라우터 생산업체 마다 조금씩 다르다.   
p.175 표  
  
롱기스트 매치(스위칭) -> AD -> 코스트 -> 부하 분산  
  
## 5.3 라우팅 설정 방법  
### 5.3.1 다이렉트 커넥티드  
  
### 5.3.2 스태틱 라우팅  
  
### 5.3.3 다이나믹 라우팅  
  