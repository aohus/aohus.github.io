---
layout: post
title: "[Network] 통신을 도와주는 네트워크 주요 기술"
subtitle:
categories: Network
tags: ["IT 엔지니어를 위한 네트워크 입문"]
---
  
  
# CHAPTER7. 통신을 도와주는 네트워크 주요 기술  
## 7.1 NAT/PAT  
Network Address Translation 는 IP주소를 다른 IP주소로 변환해 라우팅을 원활히 해주는 기술이다. L3 장비에서도 쓰이고 특히 방화벽과 로드 밸런서와 같이 세션을 다루는 L4 이상의 장비에서 많이 사용되는 기술이다.   
  
### 7.1.1 NAT/PAT의 용도와 필요성  
1) IPv4 주소 고갈문제의 솔루션으로 NAT 사용  
	- 단기: 서브네팅 / 중기: NAT / 장기: IPv6  
2) 보안을 강화하는데 사용  
3) IP 주소 체계가 같은 두 개의 네트워크 간 통신을 가능하게 해줌 #Q  당연한거 아니냐고  
4) 불필요한 설정 변경을 줄일 수 있음  
  
NAT 기술 단점  
- 네트워크 운영자 입장에서 IP가 변환되면 장애가 발생했을 때 문제 해결이 어려움  
- 애플리케이션 개발자는 NAT 환경이 대중화되면서 애플리케이션을 개발할 때 더 많은 고려사항이 생김  
- NAT 으로 인해 주소가 변환되면서 단말 간 직접적인 견결성이 무너져 이로 인해 개발자들이 애플리케이션을 제작할 때 NAT 환경을 항상 고려해야함(NAT 밑에 있는 단말도 직접 연결하게 도와주는 홀 펀칭 이라는 기술 나왔는데, 이 기술을 이용하기 위해 애플리케이션이 더 복잡해졌음...)  
  
### 7.1.2 NAT 동작 방식  
NAT 이 출발지 사용자의 출발지 IP(private ip)를 public ip로 변환해주고, 응답이 올 때 목적지가 public ip로 들어오면 private ip로 변환해 전달해준다.   
  
### 7.1.3 PAT 동작 방식  
PAT은 port 까지 mapping 해서 변환해준다. **하나의 IP 만으로도 다양한 포트 번호를 사용해 사용자를 구분할 수 있다. 하지만 이 서비스 포트의 개수는 제한되어 있어 재사용된다.** 만약 서비스 포트가 동시에 모두 사용중이거나 재사용할 수 없을 때는 PAT이 정상적으로 동작하지 않는다. 따라서 **동시 사용자가 매우 많을 때는 PAT에서 사용하는 공인 IP 주소를 IP하나가 아닌 Pool로 구성해야한다.** #Q   
=> 하나의 IP로 나갔기 때문에 돌아올 때는 어떤 단말로 가야할지 알 수 없다. 단방향 통신에만 사용된다.  
  
### 7.1.4 SNAT와 DNAT  
SNAT -> 우리집 공유기. 사설 IP를 공인 IP를 바꿔서 내보내준다.   
DNAT -> 로드 밸런서. 대표 IP로 받은 요청을 각 서버 IP를 도착지로 보내준다.   
  
### 7.1.5 동적 NAT와 정적 NAT  
출발지와 목적지 IP를 미리 매핑해 고정해 놓으면 NAT, NAT을 수행할 때 IP를 동적으로 변경하면 동적 NAT. 동적 NAT에는 출발지나 목적지 중 한 곳이 다수의 IP 로 구성된 pool 이나 레인지로 설정된다.   
  
## 7.2 DNS  
네트워크 프로토콜은 크게 두 가지이다.   
- 실제로 데이터를 실어 나르는 **데이터 프로토콜**  
- 이 데이터 프로토콜이 잘 동작하도록 도와주는 **컨트롤 프로토콜**  
	- 컨트롤 프로토콜은 통신에 직접 관여하지 않지만 처음 통신 관계를 맺거나 유지하는데 큰 역할을 한다. TCP/IP 프로토콜 체계를 유지하기 위한 주요 컨트롤 프로토콜에는 **ARP, ICMP, DNS**가 있다. 이중 DNS는 도메인 주소를 IP주소로 바꾸는 역할을 한다.   
  
### 7.2.1 DNS 소개  
12자리 숫자로 된 주소보다 의미 있는 문자열로 구성된 도메인 주소가 우리가 인식하고 기억하기 더 쉽다. 또한 서비스 IP 가 바뀌더라도 도메인 주소는 그대로 유지할 수 있어 접속 방법 변경 없이 서비스를 운영할 수 있다.   
사용자가 문자열로 구성된 도메인 주소로 요청을 하면 도메인 주소가 DNS 서버로 보내지고, DNS 서버에서는 해당 도메인의 IP 주소를 알려준다.   
### 7.2.2 DNS 구조와 명명 규칙  
도메인은 계층 구조여서 원하는 주소를 효율적으로 찾아갈 수 있다.   
Third.second.top. 레벨로 구성되어있으며 top level 부터 앞으로 해석한다.   
- 도메인은 최대 128 계층까지 구성할 수 있다.   
- 계층별 길이는 최대 63바이트까지 이용할 수 있고   
- 도메인 계층을 구분하는 구분자 '.'를 포함한 전체 도메인 네임의 길이는 최대 255바이트까지 사용할 수 있다.   
- 문자는 알파벳, 숫자, - 만 사용가능하고 대소문자 구분 없다.   
  
#### 7.2.2.1 루트도메인  
루트도메인은 도메인을 구성하는 최상위 영역. DNS 서버에 해당 도메인 정보가 없으면 루트 도메인을 관리하는 루트 DNS에 쿼리함.  
루트 DNS는 전 세계에 13개  
  
#### 7.2.2.2 Top-Level Domain  
- Generic(gTLD) : 일단적으로 사용  
	- .com, .edu, .gov, .int, .mil, .net, .org ...  
- country-code(ccTLD)  
	- kr  
- sponsored(sTLD) : 특정 목적집단  
	- .aero, .asia, .museum ...  
- infrastructure :인프라 식별자 공간을 지원  
	- .arpa  
- generic-restricted(grTLD) : 특정 기준을 충족하는 사람이나 단체 가 사용  
	- .biz, .name, .pro  
- test(tTLD) : IDN 개발 프로세스에서 테스트 목적으로 사용  
	- .test  
  
### 7.2.3 DNS 동작 방식  
로컬에서 도메인과 IP 주소를 관리하는 파일을 hosts 파일이라고 한다. hosts 파일에 도메인과 IP 주소를 설정해두면 해당 도메인 리스트는 항상 DNS 캐시에 저장된다. 도메인을 쿼리하면 DNS 서버에 쿼리하기 전 로컬 캐시 정보를 확인한다. DNS로 부터 응답을 받아도 그 결과를 캐시에 먼저 저장한다.   
  
**DNS관점에서 도메인에 대한 결괏값을 보내주는 과정**  
p.236 그림  
재귀적 쿼리 : 쿼리를 보낸 클라이언트에 서버가 최종 결괏값을 반환하는 서버 중심 쿼리 -> 클라이언트-DNS  
반복적 쿼리 : 최종값을 받을 때까지 클라이언트에서 쿼리를 계속 진행하는 방식 -> DNS  - 상위 DNSs  
  
### 7.2.4 마스터와 슬레이브  
마스터와 슬레이브는 도메인에 대한 존 관리를 직접하는지 여부로 구분한다.   
  
### 7.2.5 DNS 주요 레코드  
### 7.2.6 DNS에서 알아두면 좋은 내용  
#### 7.2.6.1 도메인 위임  
특정 도메인 내의 모든 레코드를 그 네임 서버가 직접 관리하지 않고 일부 영역에 대해서는 다른 곳에서 레코드를 관리하도록 위임하는 것을 도메인 위임  
#### 7.2.6.2 TTL  
DNS의 응답값을 캐시에서 유지하는 시간. 서비스의 성질과 도메인 정보의 갱신 빈도에따라 TTL값ㅇ르 적절히 조절하는 것이 좋음.  
#### 7.2.6.3 화이트 도메인  
대량 이메일 발송시 스팸으로 분류되지 않게 하기 위해 한국 인터넷 진흥원에 등록해놓는 화이트 도메인  
#### 7.2.6.4 한글 도메인  
유니코드 이용해서 한글 도메인을 사용할 수 있음. 변환해야함.   
  
### 7.2.9 호스트 파일 설정  
리눅스(mac) 호스트 파일 : /etc/hosts  
  
## 7.3 GSLB  
GSLB(Global Server/Service Load Balancing) 도메인을 이용한 로드밸런싱 구현을 도와줌. GSLB는 DNS 와 동일하게 도메인 질의에 응답해주는 역할과 동시에 로드밸런서 처럼 등록된 도메인에 연결된 서비스가 정상적인지 헬스 체크를 수행함. - 인텔리전스 DNS라고도 부름  
  
### 7.3.1 GSLB 동작 방식  
### 7.3.2 GSLB 구성방식  
- 도메인 자체를 GSLB 로 사용  
- 도메인 내의 특정 레코드만 GSLB를 사용  
	- 별칭(Alias)사용 (CNAME 레코드 사용)  
	- 위임(Delegation) 사용(NS 레코드 사용)  
  
### 7.3.3 GSLB 분산 방식  
GSLB를 이용해 서비스를 분산하면 다음과 같은 주요 목적을 달성할 수 있다.   
- 서비스 제공 가능 여부를 체크해 트래픽 분산  
- 지리적으로 멀리 떨어진 다른 데이터 센터에 트래픽 분산  
- 지역적으로 가까운 서비스에 접속해 더 빠른 서비스 제공이 가능하도록 분산  
  
분산 방식  
- 서비스 응답시간/지연(RTT/Latency) : 서비스 요청에 대한 응답이 얼마나 빠른지 또는 지연이 얼마나 없는지 확인하고 서비스를 분산 처리  
- IP에 대한 지리 정보 : 서비스 제공이 가능한 각 사이트의 IP 주소에 대한 Geo 값을 확인해 가까운 사이트로 서비스를 분산 처리  
	-> 참고로 응답시간이나 IP주소에 대한 Geo 값은 사용자 기준이 아니라 사용자가 바라보는 local dns와 gslb 간 값이므로 설정에 유의해야합니다.   
  
## 7.4 DHCP  
DHCP: IP를 동적으로 할당하는데 사용되는 프로토콜. DHCP 사용하면 사용자가 직접 입력해야하는 IP 주소, 서브넷 마스크, 게이트웨이, DNS  정보를 자동으로 할당받아 사용할 수 있다.   
  
### 7.4.1 DHCP 프로토콜  
DHCP는 BOOTP라는 프로토콜을 기반으로 한다. 자세한 내용은 RFC 2131에 있다.(응?)  
  
### 7.4.2 DHCP 동작 방식  
p. 278 그림  
  
### 7.4.3 DHCP 서버 구성  
DHCP 서버는 윈도 서버의 DHCP 서비스 혹은 리눅스의 DHCP 데몬을 사용해 구성할 수 있다.   
  
### 7.4.4 DHCP 릴레이  
DHCP 서버에서 IP를 할당받기 위해 DHCP 클라이언트와 서버간에 전송되는 패킷은 모두 브로드캐스트이다. 브로드캐스트는 동일 네트워크에서만 전송되므로 DHCP를 사용하려면 각 네트워크 마다 DHCP 서버가 있어야한다.   