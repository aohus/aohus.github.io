---
layout: post
title: "[Network] 보안"
subtitle:
categories: Network
tags: ["IT 엔지니어를 위한 네트워크 입문"]
---
    
# CHAPTER9. 보안  

## 9.1 보안의 개념과 정의  
보안은 "안전을 지키는 일"이다.   

### 9.1.1 정보 보안의 정의  
정보 보안 : 다양한 위협으로 부터 보호하는 것, 우리가 생산하거나 유지해야 할 정보에 위험이 발생하거나 사고가 날 염려 없이 편안하고 온전한 상태를 유지하는 일련의 활동  

3대 보안 정의  
- 기밀성 : 인가되지 않은 사용자가 정보를 보지 못하게 하는 작업  
- 무결성 : 정확하고 안전한 정보유지에 필요한 작엄, 해시 함수를 이용해 변경 여부를 파악한다.   
- 가용성 : 정보가 필요할 때, 접근을 허락하는 일련의 작업  
- 기타 : 진정성, 책임성, 부인 방지, 신뢰성 등  

### 9.1.2 네트워크의 정보 보안  
네트워크 송수신 도중에 정보의 훼손, 변조, 유출을 막기 위한 관리적 기술적 방법  

### 9.1.3 네트워크 보안의 주요 개념  
네트워크 보안의 목표 : 외부 네트워크로부터 내부 네트워크를 보호하는 것  
- 외부로 부터 보호받아야 할 네트워크 : 트러스트 네트워크  
- 신뢰할 수 없는 외부 네트워크 : 언트러스트 네트워크  
- 내부 네트워크이지만 신뢰할 수 없는 외부 사용자에게 개방해야하는 서비스 네트워크 인 경우 : **DMZ(DeMilitarized Zone) 네트워크**   

트래픽의 방향과 용도에 따른 보안  
- 인터넷 시큐어 게이트웨이   
	- 트러스트(or DMZ) 네트워크에서 언트러스트 네트워크로의 통제  
	- 인터넷으로 나갈 때는, 인터넷의 수많은 인터넷에 대한 정보와 요청 패킷을 적절히 인식하고 필터링하는 기능  
	- ex. 방화벽, SWG, 웹 필터, 애플리케이션 컨트롤, 샌드박스  
- 데이터 센터 시큐어 게이트 웨이   
	- 언트러스트 네트워크에서 트러스트로의 통신을 통제  
	- 고성능 필요, 외부의 직접적인 공격을 막아야하므로 공격 관련 정보가 중요  
	- ex. IPS, DCSG, WAF, Anti-DDoS  

#### 9.1.3.1 네트워크 보안 정책 수립에 따른 분류  
- 화이트 리스트 : 방어에 문제가 없다고 명확히 판단되는 통신만 허용하는 방식  
- 블랙 리스트 : 공격이라고 명확히 판단되거나, 문제가 있었던 IP 리스트나 패킷 리스트를 기반으로 **데이터베이스를 만들고** 그 정보를 이용해 방어  
최근 보안 위협이 증가하면서 화이트리스트 기반 정책이 많아지고 있음. 하지만 화이트리스트 기반 정책을 수립하려면 통신 정보를 상세히 알아야 하고 세부적인 통제가 필요하므로 많은 관리 인력이 필요하다. 보안 관리 인력이 부족한 경우, 블랙리스트 기반 방어 정책을 수립하고 공격 데이터베이스를 최신으로 유지하는 것이 안정적인 보안 운영을 위해 바람직하다.   

#### 9.1.3.2 정탐, 오탐, 미탐(에러 탐지 타입)   
블랙리스트 기반 데이터베이스를 이용한 방어의 단점  
-> IPS나 안티바이러스와 같은 네트워크 장비에서는 공격 데이터베이스에 따라 공격과 악성 코드를 구분해 방어한다. 공격 데이터 베이스를 아무리 정교하게 만들더라도 오작동 하는 경우가 있다.   
- 공격인데 공격으로 탐지하지 못함 **(미탐: False negative)**,  
- 공격이 다닌데도 공격으로 감지해 패킷을 드롭시킴 **(오탐: False positive)**  

### 9.1.4 네트워크 정보 보안의 발전 추세와 고려사항  
- 보안 영역 외부 -> 인프라스트럭처나 서비스의 대변화로 인해 보안이 발전  
- 보안 영역 내부 -> 해킹 기술의 발전에 대응하여 보안 장비와 서비스 개발  

## 9.2 보안 솔루션의 종류  
보안 장비의 위치와 역할에 따라 다양한 네트워크 보안 장비가 있다.   
![](https://github.com/aohus/aohus.github.io/tree/main/assets/images/posts/IMG_0276%201.jpeg?raw=true)  

### 9.2.1 DDoS 방어장비  
DoS : Denial of Service 공격은, 다양한 방법으로 공격 목표에 서비스 부하를 가해 정상적 서비스를 방해하는 공격 기법  
- DoS 원래 : 공격 출발지에서 공격함 -> 탐지가 쉽고 탐지만 한다면 IP 주소 기반으로 충분히 방어  
- 진화 DDoS : 다수의 bot을 이용해 분산 공격을 수행  

DDoS는 디도스 공격 방어하는 보안 장비. 디도스 장비는 데이터 센터 네트워크 내부와 외부의 경계에서 공격을 방어하는데, 이것은 볼류메트릭 공격을 우선 막기 위해서이다.   
- 볼류메트릭 공격 : 회선 사용량이나 그 이상의 트래픽을 과도하게 발생시켜 회선 사용을 방해하는 공격  
	- 회선을 공급해주는 ISP나 네트워크 ISP와 연결되는 데이터 센터 네트워크 가장 바깥쪽에 위치시켜 공격을 완화해야한다.   

### 9.2.2 방화벽  
4계층에서 동작하는 패킷 필터링 장비. 3,4계층 정보를 기반으로 정책을 세우고, 정책을 기준으로 패킷을 허용할지 거부할지 결정한다. 비교적 간단하고 성능도 우수(최근 ASIC, FPGA 같은 전용 칩을 이용한 가속으로 대용량을 요구하는 데이터 센터에서도 문제 없이 사용)  
### 9.2.3 IDS, IPS  
IDS(Intrusion Detection System:침입 탐지 시스템), IPS(Intrusion Prevention System:침입 방지 시스팀)   
- 방화벽에서 방어할 수 없는 다양한 애플리케이션 공격 방어. 최근에는 IDS, IPS 모두 IPS라고 통칭  
- 사전에 공격 데이터베이스(Signature)를 제조사나 위협 인텔리전스 서비스 업체로 부터 받는다.   
- 블랙리스트 기반 -> 화이트리스트 기반'도' 적용(어플리케이션 골라 방어할 수 있는? 어플리케이션 컨트롤 기능이 생겨서.... )  
- 방화벽 + IPS 장비 -> DCSG 장비 시장 커지는 중  
### 9.2.4 WAF  
WAF(Web Application Firewell) 웹서버 보호하는 전용 보안 장비. HTTP, HTTPS 처럼 웹 서버에서 동작하는 웹 프로토콜의 공격을 방어한다. 다음과 같이 다양한 형태의 장비 or 소프트웨어로 제공  
- 전용 네트워크 장비  
- 웹 서버의 플러그인  
- ADC 플러그인  
- 프록시 장비 플러그인  

IPS 에서 방어할 수 없는 IPS 회피공격을 방어.   
- WAF는 프록시 서버와 같이 패킷을 데이터 형태로 조합해 처리(<-> IPS는 데이터 조합하지 않고 처리)  
- WAF는 공격자에게 통보하거나 민감한 데이터 제거하고 보낼 수 있음(<-> IPS는 전체 공격 차단 & 후 통보 어려움)  
### 9.2.5 샌드박스  
기존: 원하는 목적지에 직접 공격 -> 보안장비가 발전하면서 보안 장비 우회를 위해 다른 공격을 개발  
- 악성 코드를 관라지 PC에 우회적으로 심고 이 악성코드를 이용해 관리자 PC를 컨트롤  
- 이후 이 PC들을 외부에서 컨트롤하도록 C&C(Cammand & Control) 서버를 만들어 두고 감염 PC들이 이 C&C 서버로 연결하도록 조작  
- 현재는 이 공격들이 APT(Advanced Persistent Threat: 지능형 지속 공격), ATA(Advanced Target Attack: 지능형 표적 공격)으로 발전  

**샌드박스**는 APT를 방어하는 대표 장비. 악성 코드를 샌드박스 시스템 안에서 실행. 가상 운영체제 안에서 실행하고 그 행동을 모니터링해서 악성 코드 여부 판별!  
### 9.2.6 NAC  
- Network Access Control  
- 네트워크에  접속하는 장치들을 제어하기 위해 개발 -> 인가된 사용자만 내부망에 접속  
### 9.2.7 IP 제어  
- 할당된 IP를 관리하고, 의도된 IP할당이 아니면 정상적으로 네트워크 사용하지 못하게 함  
### 9.2.8 접근 통제  
- 서버나 데이터베이스에 대한 직접적인 접근을 막고 작업 추적 및 감사를 할 수 있는 접근 통제 솔루션  
- 대부분 배스천 호스트 기반 구현  
### 9.2.9 VPN  
- 사용자 기반의 VPN 서비스를 제공해주는 장비를 VPN 장비라고 함  
- 현재는 대부분 방화벽이나 라우터 장비에 기능이 포함되어있음  
- IPSEC & SSL 많이 사용함  


## 9.3 방화벽  
네트워크 보안   
(+) 많은 호스트를 한번에 관리하고 보호할 수 있다.  
(-) 많은 트래픽을 감당해야하므로 속도를 유지하며 보안을 제공해야한다(어렵다).  
### 9.3.1 방화벽의 정의  
- 네트워크 중간에 위치해 해당 장비를 통과하는 트래픽을 사전에 주어진 **정책 조건**에 맞추어 허용하거나 차단하는 장비  
- 일반적으로 3,4 계층에서 동작하며 세션을 인지하는 **상태 기반 엔진**으로 동작  
### 9.3.2 초기 방화벽  
- 초기 방화벽은 패킷의 인과 관계를 확인하지 못함. 세션 정보나 방향에 관계없이 필터 (스테이트리스, 패킷필터 방화벽)  
- 패킷 필터링에 참고하는 정책 **5-tuple** : 3,4계층 헤더 중 source IP, destination ip, protocol no(tcp:6, udp:17), source port, destination port   

(+) 간단하고 부하 적음  
(-) 인터넷 통신하면 룰셋이 복잡해짐  
(-) 헤더 변조하면 방어 불가  
### 9.3.3 현대적 방화벽 등장(SPI 엔진)  
상태기반 방화벽!!   
- SPI 엔진은 패킷의 인과 관계와 방향성을 인지해 정책을 적용할 수 있다.   
### 9.3.4 방화벽 동작 방식  
> 방화벽 제조사 별로 동작 방식이 다양하므로 제조사가 제공하는 `Packet Processing Flow` 문서를 미리 확인해야한다.   

![](https://github.com/aohus/aohus.github.io/tree/main/assets/images/posts/IMG_9407.jpeg?raw=true)  

SPI 엔진 있는 방화벽은 세션 인지 기능이 있어, OSI 3,4 계층의 세부적인 필드도 확인한다.   
- TCP 컨트롤 플래그에 따라 동작 방식이 변하거나  
- 시퀀스와 ACK 번호가 갑자기 변경되는 것을 인지해 세션 탈취 공격을 일부 방어할 수 있습니다.   
=> TCP Anti-Replay 기능  

### 9.3.5 ALG  
방화벽은 애플리케이션 헤더 정보는 인지할 수 없다.   
- 세션 방화벽 등장 이전에 개발된 **고대 프로토콜**은 방화벽과 같은 **세션 장비**를 고려하지 못해 통신 중간에 방화벽이 있으면 정상적인 통신이 불가능한 경우가 발생한다. 대표적 프로토콜이  **FTP**, FTP(file transfer protocol, 파일 대량 전송)는 컨트롤 프로토콜과 데이터 프로토콜이 분리되어 동작한다.   

FTP client <-> FTP server  
1) request    :   src port 2000   ->    dst port 21   
2) response :   dst port 2000   <-    src port 21  
3) request    :   dst port 2001   <-    src port 20     (\*) 데이터 프로토콜 동작. 포트와 접속 방향 달라짐.  
4) response :   src port 2001   ->    dst port 20   

문제 해결  
1. FTP 통신 방식을 패시브 모드로 변경 (제약 있음)  
2. 방화벽에서 애플리케이션 프로토콜 확인하고 세션을 인지해 포트를 자동으로 열어준다. -> **ALG**  
3. ALG가 만능 아니며, 최근 애플리케이션이 방화벽, NAT 고려해 개발되고 STUN, 홀펀칭 기술 등 발전해서 ALG는 많이 안쓰는 추세  

### 9.3.6 방화벽의 한계  
- 공격 목표가 시스템/계정 탈취에서 서비스 중단 쪽으로 바뀌며 DDoS 공격이 새로운 트렌드  
- 대규모 웜 공격에 인터넷 서비스 마비되며 방화벽의 한계 드러남  
- 취약점은 애플리케이션이나 애플리케이션 프로토콜에 있어 방화벽으로는 대응이 불가능함.  
-> 웜 공격을 막기 위해 **IPS** 등장  

## 9.4 IDS, IPS  
방화벽은 애플리케이션 계층에서 이루어지는 공격은 방어할 수 없다. 애플리케이션 공격은 서비스를 제공하는 시스템 자체의 취약점을 이용한다.   
- 웹서비스 제공을 위해 TCP 80 포트를 외부 사용자에게 공개하면 Apache나 IIS 서버의 취약점을 악용한 공격은 방화벽에서 필터링할 수 없다.   
이런 공격을 탐지하고 방어하기 위해 IPS 개발되었다.   

### 9.4.1 IPS, IDS 정의  
IDS(Intrusion Detection System:침입 탐지 시스템) -> 복제된 트래픽 감시하고 있다가 공격 탐지하면 알람  
IPS(Intrusion Prevention System:침입 방지 시스팀) -> 공격 직접 차단  

일반적으로 IPS라고 부르는 시스템은 네트워크 기반 NIPS이다.   

### 9.4.2 IPS, IDS의 동작 방식  
기본적으로는 공격 데이터 베이스를 사용한 패턴 매칭 방식이지만 프로토콜 어노말리, 프로파일 어노말리 등도 있음  
#### 9.4.2.1 패턴 매칭 방식  
데이터베이스 방식 방어, 시크니처 방식 방어 등이라고 부름.  
특별한 문자열(db에 등록된)을 모니터링 하고 있다가 매칭되는 것이 있으면 방어한다.  

#### 9.4.2.2 어노말리 공격 방어  
패턴 방식은 공격 전 해당 공격에 대한 패턴 데이터 베이스가 필요하다. 작은 변화에도 대응이 어렵다.   
->IPS에  **화이트리스트 기반의 방어 방법 개발됨**  

**프로파일 어노말리**  
평소 관리자가 정해놓은 기준이나 IPS 장비가 모니터링해 정해진 기준과 다른 행위가 일어나면 공격으로 판단.  
- 평소 1MB 패킷이 전송되다가 갑자기 수십MB 이상의 트래픽이 발생한다던가...    
-> 나중에  DDoS 장비 됨  

**프로토콜 어노말리**  
최근에는 악성 코드 다운받아 실행하도록 유도하는 공격 방식 사용  
- 감염된 내부 PC가 외부와 공격을 위한 통신을 할 때는 잘 알려진 서비스 포트를 사용하지만, 실제 해당 서비스 포트에서 동작하는 프로토콜이 아닌 다른 프로토콜을 사용하는 경우를 파악함.   

### 9.4.3 IPS, IDS 한계와 극복(NGIPS)  
한계; 네트워크상에서 빠른 속도로 애플리케이션 레벨까지 확인하기 위해서는 플로 엔진을 사용함. 플로 엔진은 패킷을 모아 데이터 형태로 변환해 검사하는 것이 아니라 **패킷이 플러가는 상황을 모니터링해 공격을 탐지함.**   
-> IPS 장비 우회 쉬움, IPS는 오탐이 많고 튜닝 작업이 많이 필요함.   

NGIPS(Next Generation IPS)  
- 애플리케이션을 인지하거나 다양한 세스템과 연동  
- APT 공격을 방어하기 위한 기능 있음  

## 9.5 DDoS 방어 장비  
DDoS : 분산형 DoS, 다수의 공격자를 만들어 다양한 방법으로 공격 목표에 서비스 부하를 가해 정상적 서비스를 방해하는 공격 기법   
### 9.5.1 방어 장비의 정의  
DDoS는 서버 공격 -> 네트워크 장비, DNS 서비스 공격으로 확대  
DDoS는 디도스 공격 방어하는 보안 장비. 디도스 장비는 데이터 센터 네트워크 내부와 외부의 경계에서 공격을 방어하는데, 이것은 [[23.09.05 IT 엔지니어를 위한 네트워크 입문#9.5.4 볼류메트릭 공격|볼류메트릭]] 공격을 우선 막기 위해서이다. 트래픽 프로파일링 기법을 주로 사용한다.   

### 9.5.2 DDoS 방어 장비 동작 방식  
DDoS 방어 서비스 -> 클라우드 서비스, 회선 사업자의 방어 서비스, DDoS 방어 장비 사내 설치.  
탐지 장비와 방어 장비를 구분하는 경우가 많다.   
- DDoS 공격을 탐지(프로파일링 기법)해 공격하는 IP 리스트를 넘겨주면 방어 장비나 IPS 내부에서 이 IP를 버린다.  

**프로파일링 기법**  
- 평소 데이터 흐름을 습득해, 일반적인 대역폭, 세션량, 초기 접속량, 프로토콜별 사용량 등을 저장함.  
- 습득한 데이터와 일치하지 않는 과도한 트래픽이 인입되면 알려주고 차단.   

### 9.5.3 DDoS 공격 타입  
![](https://github.com/aohus/aohus.github.io/tree/main/assets/images/posts/IMG_9408.jpeg?raw=true)  

### 9.5.4 볼류메트릭 공격  
볼류메트릭 공격 : 회선 사용량이나 그 이상의 트래픽을 과도하게 발생시켜 회선 사용을 방해하는 공격  
	- 회선을 공급해주는 ISP나 네트워크 ISP와 연결되는 데이터 센터 네트워크 가장 바깥쪽에 위치시켜 공격을 완화해야한다.   

#### 9.5.4.1 좀비 PC를 이용한 볼류메트릭 공격  


## 9.6 VPN  
Virtual Private Network  
- 공중망을 이용해 논리적으로 직접 연결한 것처럼 망을 구성하는 기술, 이렇게 논리적으로 직접 연결된 것처럼 만들어 주는 통로를 터널이라고 하며 VPN을 이용하면 터널을 이용해 직접 연결한 것처럼 동작한다.   

### 9.6.1 VPN 동작 방식  
VPN은 가상 네트워크를 만들어주는 장비로 터널링 기법을 사용한다. 패킷을 터널링 프로토콜로 감싸 통신하는 기법이 터널링 기법이다. 일반적으로  VPN 이라고 부르는 프로토콜은 터널링에 보안을 위한 다양한 기술이 포함되어있다.   
- 패킷을 암호화하거나 인증하거나 무결성을 체크하는 보안 기능을 이용해, 인터넷에 패킷이 노출되어도 해커나 기관이 감청하지 못하도록 보호한다.   
- 대표적인 프로토콜은 IPSEC, SSL  

VPN 대표적 구현  
- host to host 통신보호 : 호스트간 직접 VPN 터널 연동(잘 사용 안함)  
- network to network 통신보호 : VPN to VPN 터널 - 본사 지사  
- host가 network로 접근할 때 보호 : host to VPN 터널 - 모바일 사용자가 일반 인터넷망을 통해 사내망으로 연결, IPSEC, SSL  
